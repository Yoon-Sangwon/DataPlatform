# 초기 데이터 상태 문서

이 문서는 데이터 플랫폼의 초기 데모 데이터 상태를 설명합니다. 테스트 후 초기 상태로 돌아가고 싶을 때 이 문서를 참고하세요.

## 📋 목차

1. [데모 계정](#데모-계정)
2. [데이터 자산 구조](#데이터-자산-구조)
3. [권한 요청 상태](#권한-요청-상태)
4. [사용자 권한 현황](#사용자-권한-현황)
5. [초기화 방법](#초기화-방법)

---

## 👤 데모 계정

### 관리자 계정
- **이메일**: `admin@example.com`
- **비밀번호**: `password123`
- **이름**: 관리자
- **역할**: 전체 시스템 관리자
- **권한**: 모든 데이터 조회, 권한 요청 승인/반려

### 데이터 분석가 계정
- **이메일**: `adv@example.com`
- **비밀번호**: `password123`
- **이름**: 데이터 분석가
- **역할**: 데이터 분석 업무
- **권한**: user_events 테이블 조회 권한 보유

### 일반 사용자 계정
- **이메일**: `user@example.com`
- **비밀번호**: `password123`
- **이름**: 일반 사용자
- **역할**: 일반 직원
- **권한**: 공개 데이터만 조회 가능

---

## 🗄️ 데이터 자산 구조

### Analytics DB (analytics_db)

#### 1. HR 스키마 (hr) - 기밀 데이터
모든 테이블이 `confidential` 레벨이며, 권한이 없으면 조회 불가

| 테이블명 | 설명 | 소유자 | 민감도 |
|---------|------|--------|--------|
| employees | 직원 정보 | HR System | 기밀 |
| salaries | 급여 정보 | HR System | 기밀 |
| benefits | 복리후생 정보 | HR System | 기밀 |
| performance_reviews | 성과 평가 | HR System | 기밀 |

#### 2. Logs 스키마 (logs) - 내부/기밀 혼합

| 테이블명 | 설명 | 소유자 | 민감도 |
|---------|------|--------|--------|
| api_logs | API 호출 로그 | DevOps팀 강동현 | 내부용 |
| application_logs | 애플리케이션 로그 | DevOps팀 강동현 | 내부용 |
| payment_logs | 결제 로그 | Finance팀 한지민 | 기밀 |
| security_logs | 보안 로그 | Security팀 윤서준 | 기밀 |

#### 3. Public 스키마 (public) - 공개/내부용 혼합

| 테이블명 | 설명 | 소유자 | 민감도 |
|---------|------|--------|--------|
| products | 상품 정보 | Product팀 최서연 | 공개 |
| reviews | 리뷰 데이터 | Product팀 최서연 | 공개 |
| user_events | 사용자 이벤트 | Analytics팀 이지은 | 공개 |
| users | 사용자 정보 | Analytics팀 이지은 | 내부용 |
| orders | 주문 정보 | Sales팀 박준호 | 내부용 |

### DevOps DB (devops_db)

#### CI/CD 스키마 (ci_cd)

| 테이블명 | 설명 | 소유자 | 민감도 |
|---------|------|--------|--------|
| deployments | 배포 이력 | 정데브 | 내부용 |
| build_logs | 빌드 로그 | 정데브 | 공개 |

---

## 📝 권한 요청 상태

### 대기 중인 권한 요청 (4건)

#### 일반 사용자의 요청 (2건)

1. **employees 테이블 조회 권한**
   - 요청자: 일반 사용자 (user@example.com)
   - 요청 권한: 조회 (viewer)
   - 사용 목적: 데이터 분석
   - 신청 사유: "부서별 인원 분석을 위해 직원 정보가 필요합니다. 이름, 부서, 입사일 등의 기본 정보만 확인하고자 합니다."
   - 사용 기간: 3개월
   - 신청일: 2일 전
   - 상태: ⏳ 대기 중

2. **orders 테이블 조회 권한**
   - 요청자: 일반 사용자 (user@example.com)
   - 요청 권한: 조회 (viewer)
   - 사용 목적: 리포트 작성
   - 신청 사유: "월별 주문 트렌드 리포트 작성을 위해 주문 데이터 조회가 필요합니다."
   - 사용 기간: 1개월
   - 신청일: 1일 전
   - 상태: ⏳ 대기 중

#### 데이터 분석가의 요청 (2건)

3. **salaries 테이블 개발자 권한**
   - 요청자: 데이터 분석가 (adv@example.com)
   - 요청 권한: 개발자 (developer)
   - 사용 목적: 데이터 분석
   - 신청 사유: "급여 데이터 분석을 위한 집계 쿼리 작성이 필요합니다. 연봉 통계, 부서별 평균 급여 등을 분석하려고 합니다."
   - 사용 기간: 6개월
   - 신청일: 3일 전
   - 상태: ⏳ 대기 중

4. **payment_logs 테이블 개발자 권한**
   - 요청자: 데이터 분석가 (adv@example.com)
   - 요청 권한: 개발자 (developer)
   - 사용 목적: 리포트 작성
   - 신청 사유: "결제 실패율 분석 대시보드를 만들기 위해 결제 로그 데이터가 필요합니다."
   - 사용 기간: 6개월
   - 신청일: 12시간 전
   - 상태: ⏳ 대기 중

### 처리 완료된 권한 요청 (2건)

5. **user_events 테이블 조회 권한 ✅ 승인됨**
   - 요청자: 데이터 분석가 (adv@example.com)
   - 요청 권한: 조회 (viewer)
   - 사용 목적: 데이터 분석
   - 신청 사유: "사용자 행동 패턴 분석을 위해 이벤트 데이터 조회가 필요합니다."
   - 사용 기간: 3개월
   - 신청일: 7일 전
   - 처리일: 6일 전
   - 검토자: 관리자
   - 코멘트: "분석 목적으로 승인합니다. 3개월 후 재신청 필요합니다."
   - 상태: ✅ 승인됨

6. **products 테이블 개발자 권한 ❌ 반려됨**
   - 요청자: 일반 사용자 (user@example.com)
   - 요청 권한: 개발자 (developer)
   - 사용 목적: 개발/테스트
   - 신청 사유: "개발 테스트를 위해 상품 데이터 수정 권한이 필요합니다."
   - 사용 기간: 영구
   - 신청일: 5일 전
   - 처리일: 4일 전
   - 검토자: 관리자
   - 코멘트: "개발자 권한은 개발팀 소속 직원에게만 부여 가능합니다. 조회 권한으로 재신청해주세요."
   - 상태: ❌ 반려됨

---

## 🔐 사용자 권한 현황

### 관리자 (admin@example.com)
- 모든 데이터에 대한 전체 권한 보유 (시스템 관리자)

### 데이터 분석가 (adv@example.com)
| 테이블 | 권한 레벨 | 부여일 | 만료일 |
|--------|-----------|--------|--------|
| user_events | 조회 (viewer) | 6일 전 | 3개월 후 |

### 일반 사용자 (user@example.com)
- 공개 데이터만 조회 가능
- 현재 부여된 추가 권한 없음

---

## 🔄 초기화 방법

### 권한 요청만 초기화

데모 계정들의 권한 요청만 삭제하고 샘플 데이터를 다시 추가하려면:

```sql
-- 1. 기존 권한 요청 삭제
DELETE FROM permission_requests
WHERE requester_email IN ('user@example.com', 'adv@example.com');

-- 2. 최신 마이그레이션 재실행
-- 마이그레이션 파일: supabase/migrations/[latest]_add_sample_permission_requests.sql
-- 해당 파일의 INSERT 문들을 다시 실행
```

### 전체 데이터 초기화

모든 데이터를 완전히 초기 상태로 되돌리려면:

```sql
-- 1. 모든 권한 요청 삭제
DELETE FROM permission_requests;

-- 2. 모든 사용자 권한 삭제 (관리자 제외)
DELETE FROM user_permissions
WHERE user_id NOT IN (
  SELECT id FROM auth.users WHERE email = 'admin@example.com'
);

-- 3. 모든 코멘트 삭제
DELETE FROM comments;

-- 4. 마이그레이션 파일 순서대로 재실행
-- supabase/migrations/ 폴더의 파일들을 순서대로 재실행
```

### 마이그레이션으로 초기화

프로젝트 루트에서 다음 명령 실행:

```bash
# 권한 요청 샘플 데이터 재생성 마이그레이션 실행
# (이 방법은 자동으로 기존 데이터를 삭제하고 새로 추가합니다)
```

---

## 📊 테스트 시나리오

### 관리자 테스트 시나리오

1. **데이터 포털에서 권한 요청 확인**
   - 로그인: admin@example.com
   - 좌측 트리에서 employees, orders, salaries, payment_logs 테이블에 주황색 뱃지 확인
   - 각 테이블 클릭 → "권한 요청" 탭에서 대기 중인 요청 확인

2. **권한 요청 승인**
   - employees 테이블의 일반 사용자 요청 승인
   - 승인 코멘트 입력: "부서별 분석 목적으로 승인합니다."

3. **권한 요청 반려**
   - salaries 테이블의 분석가 요청 반려
   - 반려 사유 입력: "급여 데이터는 HR 팀장 승인이 필요합니다."

4. **관리자 대시보드에서 일괄 확인**
   - "관리자" 탭 클릭
   - 모든 권한 요청 한번에 확인
   - 통계 정보 확인

### 일반 사용자 테스트 시나리오

1. **권한 요청 확인**
   - 로그인: user@example.com
   - 하단 "내 권한 요청" 섹션에서 2건의 대기 중 요청 확인
   - 1건의 반려된 요청 확인

2. **새 권한 요청**
   - users 테이블 선택
   - "권한 신청" 버튼 클릭
   - 신청서 작성 및 제출

3. **승인 후 데이터 접근**
   - employees 테이블 접근
   - "스키마", "미리보기" 탭 확인

### 데이터 분석가 테스트 시나리오

1. **기존 권한으로 작업**
   - 로그인: adv@example.com
   - user_events 테이블 접근 (승인된 권한)
   - SQL Workspace에서 쿼리 실행

2. **대기 중인 요청 확인**
   - 하단 "내 권한 요청"에서 2건의 대기 중 요청 확인

3. **추가 권한 요청**
   - security_logs 테이블 선택
   - 조회 권한 신청

---

## 📝 주의사항

1. **비밀번호**: 모든 데모 계정의 비밀번호는 `password123`입니다.
2. **데이터 보존**: 마이그레이션 재실행 시 기존 커스텀 데이터는 삭제될 수 있습니다.
3. **권한 만료**: 승인된 권한은 설정된 기간 후 자동으로 만료되지 않습니다 (수동 관리 필요).
4. **RLS 정책**: 모든 테이블에 Row Level Security가 적용되어 있습니다.

---

## 🔗 관련 마이그레이션 파일

- `20260204033837_create_demo_users.sql` - 데모 계정 생성
- `20260204051948_add_initial_user_permissions.sql` - 초기 권한 설정
- `[latest]_add_sample_permission_requests.sql` - 샘플 권한 요청 데이터

---

**마지막 업데이트**: 2026-02-04
**작성자**: 시스템 관리자
